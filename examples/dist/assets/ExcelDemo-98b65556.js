import{l as C,r as R,S as B,a as h,g as k,b as $,t as T,c as D}from"./hack-064cad53.js";import{d as L}from"./url-de9b02cf.js";import{d as q,_ as F,r as m,o as V,n as W,h as j,w as I,a as E,c as M,b as N,i as P,e as A,f as H,j as U,g as z,u as G}from"./index-50d431e6.js";import{P as J,u as O}from"./PreviewWrapper-97fd9bf3.js";import"./_commonjs-dynamic-modules-302442b1.js";const K=q({name:"VueOfficeExcel",props:{src:[String,ArrayBuffer,Blob],requestOptions:{type:Object,default:()=>({})},options:{type:Object,default:()=>({minColLength:20})}},emits:["rendered","error"],setup(t,{emit:i}){const n=m(null),s=m(null);let r={_worksheets:[]},a=[],d=1,u=null,e=null,f=null,p=null;function _(c){p=c,$(c).then(l=>{if(!l._worksheets||l._worksheets.length===0)throw new Error("未获取到数据，可能文件格式不正确或文件已损坏");const{workbookData:x,medias:g,workbookSource:o}=T(l,t.options);a=g,r=o,f=null,d=1,D(),e.loadData(x),h(u,a,r._worksheets[d],f),i("rendered")}).catch(l=>{console.warn(l),a=[],r={_worksheets:[]},D(),e.loadData({}),i("error",l)})}const v=C.debounce(R,200).bind(this,s.value),b=new MutationObserver(v),S={attributes:!0,childList:!0,subtree:!0};V(()=>{W(()=>{b.observe(s.value,S),v(s),window.xs=e=new B(s.value,{mode:"read",showToolbar:!1,showContextmenu:t.options.showContextmenu||!1,view:{height:()=>n.value&&n.value.clientHeight||300,width:()=>n.value&&n.value.clientWidth||1200},row:{height:24,len:100},col:{len:26,width:80,indexWidth:60,minWidth:60},autoFocus:!1}).loadData({});let c=e.bottombar.swapFunc;e.bottombar.swapFunc=function(o){c.call(e.bottombar,o),d=o+1,setTimeout(()=>{e.reRender(),h(u,a,r._worksheets[d],f)})};let l=e.sheet.editor.clear;e.sheet.editor.clear=function(...o){l.apply(e.sheet.editor,o),setTimeout(()=>{h(u,a,r._worksheets[d],f)})};let x=e.sheet.editor.setOffset;e.sheet.editor.setOffset=function(...o){x.apply(e.sheet.editor,o),f=o[0],h(u,a,r._worksheets[d],f)},u=s.value.querySelector("canvas").getContext("2d"),t.src&&k(t.src,t.requestOptions).then(_).catch(o=>{e.loadData({}),i("error",o)})})}),j(()=>{b.disconnect(),e=null}),I(()=>t.src,()=>{t.src?k(t.src,t.requestOptions).then(_).catch(c=>{e.loadData({}),i("error",c)}):e.loadData({})});function y(c){L(c||`vue-office-excel-${new Date().getTime()}.xlsx`,p)}return{wrapperRef:n,rootRef:s,download:y}}}),Q={class:"vue-office-excel",ref:"wrapperRef"},X={class:"vue-office-excel-main",ref:"rootRef"};function Y(t,i,n,s,r,a){return E(),M("div",Q,[N("div",X,null,512)],512)}const w=F(K,[["render",Y]]);w.install=function(t){t.component(w.name,w)};const se={__name:"ExcelDemo",setup(t){function i(){O.hideLoading()}function n(a){console.log("出差",a),O.hideLoading()}const s=location.origin+(location.pathname+"/").replace("//","/")+"static/test-files/test.xlsx",r=m();return(a,d)=>{const u=P("loading");return E(),A(J,{accept:".xlsx",placeholder:"请输入xlsx文件地址","default-src":s},{default:H(e=>[U(z(G(w),{ref_key:"docxRef",ref:r,src:e.src,style:{flex:"1",height:"0"},onRendered:i,onError:n},null,8,["src"]),[[u,!0]])]),_:1})}}};export{se as default};
